//2019-06-24
!function(t){"use strict";window.JCaptcha=function(t,e,i,s,a,n,o,c,l,r,h,d,p,u,f){function v(t){return t||function(){}}t.logger={log:function(e){t.console,0}};var y=function(i,a,n){var o="jd_captcha_"+(f(1e4*p.random())+(new c).valueOf());t[o]=function(e){a(e),t[o]=void 0;try{delete t[o]}catch(t){}};var l="?";-1!=i.indexOf("?")&&(l="&"),function(t,i){var a=e.getElementsByTagName("head")[0],n=e.createElement("script");n.charset="UTF-8",n.async=!0,n.onerror=function(){i(!0)};var o=!1;n.onload=n.onreadystatechange=function(){o||n.readyState&&"loaded"!==n.readyState&&"complete"!==n.readyState||(o=!0,s(function(){i(!1)},0))},n.src=t,a.appendChild(n)}(i=i+l+"callback="+o,function(t){t&&n&&n()})};function g(t,e,i){var s=[];for(var a in e instanceof l?s=e:s.push(e),s){var n=s[a];t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent?t.attachEvent("on"+n,i):t["on"+n]=i}}function m(t,e,i){var s=[];for(var a in e instanceof l?s=e:s.push(e),s){var n=s[a];t.removeEventListener?t.removeEventListener(n,i,!1):t.attachEvent&&t.detachEvent("on"+n,i)}}function x(t,e){for(var i=t.className?t.className.split(" "):[],s=[],a=0;a<i.length;a++)e!=i[a]&&s.push(i[a]);t.className=s.join("")}function T(t,e,i){for(var s=function(t,e){for(var i=t.className.split(/\s+/),s=0;s<i.length;s++)if(i[s]==e)return!0;return!1},a=t.getElementsByTagName(i),n=[],o=0;o<a.length;o++)s(a[o],e)&&n.push(a[o]);return n}function w(i){this.config=i,this.show=function(i,s){var a=s.anchorView,n=s.side,o=e.createElement("div");o.id="_jslide_maskLayer",o.style.position="fixed",o.style.top=0,o.style.left=0,o.style.width="100%",o.style.height="100%",o.style.backgroundColor="#999",o.style.opacity=0,o.style.filter="alpha(opacity=0)",o.style.zIndex=10001,o.style.transitionProperty="opacity",o.style.transitionDuration="0.3s",o.style.transitionTimingFunction="ease",e.body.appendChild(o);var c=e.createElement("div");c.id="_jslide_popupContainer",c.style.position="absolute",c.style.zIndex=10002,c.style.transitionProperty="opacity",c.style.transitionDuration="0.3s",c.style.transitionTimingFunction="ease",e.body.appendChild(c),c.appendChild(i);var l,r,h,d,u,f,v,y,m,x=i.offsetWidth,T=i.offsetHeight,w=a?(l=a.getBoundingClientRect(),r=e.body,h=e.documentElement,d=t.pageYOffset||h.scrollTop||r.scrollTop,u=t.pageXOffset||h.scrollLeft||r.scrollLeft,f=h.clientTop||r.clientTop||0,v=h.clientLeft||r.clientLeft||0,y=l.top+d-f,m=l.left+u-v,{top:p.round(y),left:p.round(m)}):"";this.maskLayer=o,this.popContainer=c;var C=this;if(g(o,"click",function(){C.config.validateRequired||C.destroy(!0)}),"top"==n){var S=w.left,j=w.top-T-5;c.style.left=S+"px",c.style.top=j+"px"}else if("left"==n){var S=w.left-x,j=w.top;c.style.left=S+"px",c.style.top=j+"px"}else if("down"==n){var S=w.left,j=w.top+a.offsetHeight;c.style.left=S+"px",c.style.top=j+"px"}else if("right"==n){var S=w.left+a.offsetWidth,j=w.top;c.style.left=S+"px",c.style.top=j+"px"}else"middle"==n&&(o.style.opacity=.6,o.style.filter="alpha(opacity=60)",c.style.position="fixed",c.style.left="50%",c.style.top="50%",c.style.marginLeft=-i.offsetWidth/2+"px",c.style.marginTop=-i.offsetHeight/2+"px")},this.isDestroyed=function(){return void 0!=this.destroyed&&this.destroyed},this.destroy=function(t){if(!this.isDestroyed()){this.maskLayer.style.opacity="0",this.popContainer.style.opacity="0";var i=this.maskLayer,a=this.popContainer;s(function(){e.body.removeChild(i),e.body.removeChild(a)},300),t&&this.config.onDestroy&&this.config.onDestroy(),this.destroyed=!0}}}var C=['<div class="jcaptcha-window" >','        <div class="jcaptcha-container jcaptcha-shadow">','            <div class="jcaptcha-content" style="position:relative;">','                <div class="jcaptcha-bg-img" style="width:312px;height:160px;overflow:hidden"></div>','                <div class="jcaptcha-shadower-img" style="position:absolute;height:160px;width:59px;left:0px;top:0px;overflow: hidden"></div>','                <div class="jcaptcha-validate-result">','                    <div class="jcaptcha-validate-result-txt">完成拼接，检验通过</div>',"                </div>",'                <div class="jcaptcha-icon-refresh" title="刷新"></div>',"            </div>",'            <div class="jcaptcha-slide" style="width:312px">','                <div class="jcaptcha-slide-thumbnail" id="slideThumbnail">','                    <span class="jcaptcha-icon-right-arrow"></span>',"                </div>",'                <div class="jcaptcha-slide-track-text">拼接图片完成校验</div>',"            </div>",'            <div class="jcaptcha-action"></div>',"        </div>","    </div>"].join(""),S=function(t,e,i){for(var s=t+e+i,a=0,n=0;n<s.length;n++)a+=s.charAt(n).charCodeAt();return a};function j(t){this.options=t,this.onCommit=this.options.onCommit,this.onRefresh=this.options.onRefresh,this.bgImgSrc=this.options.bgImg;var i=this;this.ele=e.createElement("div"),this.ele.innerHTML=C,e.body.appendChild(this.ele),this.init=function(){this.initImg(this.bgImgSrc),this._init();var t=T(this.ele,"jcaptcha-icon-refresh","DIV")[0];g(t,["click"],function(t){i.onRefresh()}),"embedded"==this.options.display.modal||(this.popManager=new w({validateRequired:this.options.validateRequired,onDestroy:function(){i.options.onClose&&i.options.onClose()}}),this.popManager.show(this.getView(),this.options.display))},this.refreshImg=function(){var t=this.bgImgSrc+"&r="+p.random();this.initImg(t)},this.initImg=function(t){this._initImg(t)},this.reset=function(){this._reset()},this.destroy=function(){this._destroy();try{"embedded"==this.options.display.modal?e.body.removeChild(this.ele):this.popManager&&!this.popManager.isDestroyed()&&this.popManager.destroy(!1)}catch(t){}},this.hideText=function(){var t=T(e,"jcaptcha-validate-result","div")[0];t.style.opacity=0,t.style.filter="Alpha(opacity=0)",s(function(){t.style.display="none"},1)},this.showText=function(t){var i=T(e,"jcaptcha-validate-result","div")[0];i.style.display="block",s(function(){i.style.opacity=.95,i.style.filter="Alpha(opacity=95)"},0);var a="";0==t?a="检验通过":2==t?a="验证码已失效，重新校验":3==t?a="加载图片 ...":4==t?a="网络原因，请刷新":5==t?a="尝试过多":6==t&&(a="哎呀，检测到网络风险，请稍后再试");var n=T(e,"jcaptcha-validate-result-txt","div")[0];n.innerHTML=a},this.close=function(){this.destroy(),this.options.onClose&&this.options.onClose()},this.showErrorTip=function(t){this.ele.className=this.ele.className+" shakeAnimation";var e=this.ele;s(function(){e.className=e.className.replace(/shakeAnimation/g,"").replace(/\s/g,"")},200),this._showErrorTip&&this._showErrorTip(t)},this.getView=function(){return this.ele}}function I(t){t.display=t.display||{modal:"popup",side:"middle"},t.sceneId=t.sceneId||t.bizId||t.biz_id,this.config=t,this.sceneId=t.sceneId,this.jslideCaptcha=null,this.currentSig=null,this.data="",this.api_get_captcha=this.config.apiServer+"/public2/getCaptcha.do?sceneId="+this.sceneId+"&requestId=",this.api_refresh_captcha=this.config.apiServer+"/public2/refreshCaptcha.do?sceneId="+this.sceneId+"&sig=",this.api_validate_captcha=this.config.apiServer+"/public2/validateCaptcha.do?sceneId="+this.sceneId+"&sig=";var i,s,a,n=t.staticServer+"/statics/slidecaptcha/v1/slide.min.css?v=20190419";i=n,s=e.getElementsByTagName("head")[0],(a=e.createElement("link")).href=i,a.rel="stylesheet",a.type="text/css",s.appendChild(a)}return I.prototype.initOne=function(t){var i=t.onValidateSuccess,a=t.onValidateFail,n=t.onRenderSuccess,o=t.onClose,c=this,l=this.config,r=t.requestId||"",d=t.validateRequired||l.validateRequired;y(this.api_get_captcha+r,function(t){var r=t.data;c.currentSig=r.sig,c.data="";var u=r.url,v=r.captchaType,w=null;function C(){w.reset(),y(c.api_refresh_captcha+c.currentSig,function(t){w.refreshImg()},function(){})}var I={bgImg:u,display:l.display,validateRequired:d,onCommit:function(t){!function(t){logger.log("distance:"+t);var e=S(c.sceneId,c.currentSig,t);c.data=t+"-"+e;var n=c.api_validate_captcha+c.currentSig+"&data="+c.data+"&s="+e;y(n,function(t){if(t&&t.data&&2!=t.data.result&&3!=t.data.result){if(0==t.data.result)w.showText(0),s(function(){i(c.data),w.close()},1e3);else if(1==t.data.result){var e=t.data.tryTooManyTime;c.data="",1==e?(C(),w.showErrorTip("尝试过多，请重试"),a("3")):(w.reset(),w.showErrorTip(),a("1"))}}else c.data="",w.reset(),3==t.data.result?w.showText(6):w.showText(2),s(function(){w.close(),a("2")},1e3)},function(){c.data="",w.showText(2),s(function(){a("2"),w.close()},1e3)})}(t)},onRefresh:function(){C()},onClose:function(){o()}};(w="ClickCaptcha"!=v?new function(t){j.call(this,t);var i=this;this.sliderShadower=T(this.ele,"jcaptcha-shadower-img","div")[0],this.slideElement=T(this.ele,"jcaptcha-slide","div")[0],this.slider=null,this._init=function(){this.slider=new function(t,i){this.ele=t,this.options=i,this.slide=T(e,"jcaptcha-slide","DIV")[0],this.shadowerImg=T(e,"jcaptcha-shadower-img","div")[0],this.slideThumbnail=T(t,"jcaptcha-slide-thumbnail","DIV")[0],this.slideTrackText=T(t,"jcaptcha-slide-track-text","DIV")[0],this.xDistance=0,this.minLeft=0,this.maxLeft=this.slide.offsetWidth-this.shadowerImg.offsetWidth,this.slideStart=!1,this.init=function(){var t=this,i=function(e){t.handleStart(e)},s=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,t.handleMove(e)},a=function(e){t.handleOut(e)};g(this.slideThumbnail,["mousedown","touchstart"],i),g(e,["mousemove","touchmove"],s),g(e,["mouseup","touchend","touchcancel"],a),this.destroy=function(){m(this.slideThumbnail,["mousedown","touchstart"],i),m(e,["mousemove","touchmove"],s),m(e,["mouseup","touchend","touchcancel"],a)}},this.getView=function(){return this.ele},this.handleStart=function(t){logger.log("handleStart==>"+t.type),this.slideStart=!0,-1!=t.type.indexOf("touch")?this.slideStartClientX=t.touches[0].clientX:this.slideStartClientX=t.clientX,logger.log("handleStart==>"+t.type+" slideStartClientX:"+this.slideStartClientX),x(this.slideThumbnail,"left-transition"),this.options.onStart&&this.options.onStart()},this.handleMove=function(t){if(1==this.slideStart){this.slideTrackText.style.display="none";var e=-1!=t.type.indexOf("touch")?t.touches[0].clientX:t.clientX;this.xDistance=e-this.slideStartClientX,logger.log("handleMove======>"+t.type+" clientX, xDistance, slideStartClientX"+e+","+this.xDistance+","+this.slideStartClientX),this.xDistance=p.min(p.max(0,this.xDistance),this.maxLeft),this.slideThumbnail.style.left=this.xDistance+"px",this.options.onMove&&this.options.onMove(this.xDistance)}},this.handleOut=function(t){1==this.slideStart&&(this.options.onRelease&&this.options.onRelease(this.xDistance),this.slideStart=!1)},this.reset=function(){this.slideStart=!1,this.slideThumbnail.className=this.slideThumbnail.className+" left-transition",this.slideThumbnail.style.left=this.minLeft+"px",this.slideTrackText.style.display="inline-block",this.slideStartClientX=0}}(this.slideElement,{onRelease:function(t){i.onCommit(t)},onStart:function(){x(i.sliderShadower,"left-transition")},onMove:function(t){i.sliderShadower.style.left=t+"px"}}),this.slider.init()},this._initImg=function(t){this.showText(3);var e=T(i.ele,"jcaptcha-shadower-img","div")[0],a=T(i.ele,"jcaptcha-bg-img","div")[0],n=new h;n.src=t,n.style.width="372px",n.style.height="160px",n.style.marginLeft="-60px",s(function(){n.style.marginLeft="-60px"},0),a.innerHTML="",a.appendChild(n);var o=new h;o.src=t,o.onload=function(){i.hideText()},o.onerror=function(){this.showText(3)},e.innerHTML="",e.appendChild(o)},this._reset=function(){this.slider.reset(),this.sliderShadower.style.left="0px",this.sliderShadower.className=i.sliderShadower.className+" left-transition"},this._destroy=function(){this.slider.destroy()}}(I):new function(t){j.call(this,t);var i=this;this._init=function(){this.ele.className="jcaptcha-clickcaptcha",this.slideTrackText=T(this.ele,"jcaptcha-slide-track-text","DIV")[0],this.trackOriginalInnerHTML="请点击<b>倒立</b>的两个汉字",this.slideTrackText.innerHTML=this.trackOriginalInnerHTML;var t=T(this.ele,"jcaptcha-content","DIV")[0],s=T(this.ele,"jcaptcha-bg-img","DIV")[0];g(s,["click"],function(s){var a=T(t,"jcaptcha-clicked","DIV");if(!(a.length>=2)){var n=e.createElement("div");n.className="jcaptcha-clicked jcaptcha-clicked-icon-"+(a.length+1);var o,c,l,r,h=(c=((o=s).target||o.srcElement).getBoundingClientRect(),l=o.clientX-c.left,r=o.clientY-c.top,{x:f(l),y:f(r)}),d=p.max(0,h.x-f(13)),u=p.max(0,h.y-f(33));if(n.style.left=d+"px",n.style.top=u+"px",n.coords_x=h.x,n.coords_y=h.y,t.appendChild(n),a.push(n),a.length>=2){for(var v=[],y=0;y<a.length;y++){var g=a[y],m=g.coords_x+","+g.coords_y;v.push(m)}i.onCommit(v.join(";"))}}})},this._initImg=function(t){this.showText(3);var e=T(i.ele,"jcaptcha-bg-img","div")[0];e.innerHTML="";var s=new h;s.src=t,s.onload=function(){i.hideText()},s.onerror=function(){i.showText(3)},e.appendChild(s)},this._reset=function(){for(var t=T(this.ele,"jcaptcha-content","DIV")[0],e=T(t,"jcaptcha-clicked","DIV"),i=0;i<e.length;i++)t.removeChild(e[i])},this._destroy=function(){},this._showErrorTip=function(t){this.slideTrackText.className=this.slideTrackText.className+" jcaptcha-error-tip";var e=t||"校验失败，请重试";this.slideTrackText.innerHTML="<b>"+e+"</b>";var i=this.slideTrackText,a=this.trackOriginalInnerHTML;s(function(){var t=i.className;i.innerHTML=a,i.className=t.replace(/jcaptcha-error-tip/g,"").replace(/\s/g,"")},1e3)}}(I)).init(),c.jcaptcha=w,n()})},I.prototype.getData=function(){return this.data},I.prototype.getJson=function(){return'{"sceneId": "'+this.config.sceneId+'", "sig": "'+this.getSig()+'", "data": "'+this.data+'"}'},I.prototype.getSig=function(){return this.currentSig},I.prototype.show=function(t){return this.jslideCaptcha&&this.jslideCaptcha.destroy(),t.onClose=v(t.onClose),t.onValidateSuccess=v(t.onValidateSuccess),t.onValidateFail=v(t.onValidateFail),t.onRenderSuccess=v(t.onRenderSuccess),this.initOne(t)},I}(window,document,navigator,setTimeout,clearTimeout,encodeURIComponent,Object,Date,Array,String,Image,RegExp,Math,XMLHttpRequest,parseInt)}();